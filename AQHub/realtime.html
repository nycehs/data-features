
<!DOCTYPE html>

<html lang="en" dir="ltr">

<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Corrects IE Compatibility Mode -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Explore your neighborhood's air quality</title>

    <!--Fontawesome Icons-->
    <link rel="stylesheet" href="https://nycehs.github.io/Portal-Core-Repo/fontawesome/css/all.min.css">
    <!--NYC Core Framework Theme-->
    <link rel="stylesheet" href="https://nycehs.github.io/Portal-Core-Repo/css/theme.css">
    <!--Custom additions for Portal items-->
    <link rel="stylesheet" href="https://nycehs.github.io/Portal-Core-Repo/css/custom.css">

    <!--AQE styles-->
    <link rel="stylesheet" href="css/aqe.css">

    <!--Vega dependencies-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.6.11/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.8.7/polyfill.js"></script>
    <script src="https://vega.github.io/vega/assets/promise.min.js"></script>
    <script src="https://vega.github.io/vega/assets/symbol.min.js"></script>
    <script src="https://vega.github.io/vega/assets/fetch.min.js"></script>
    

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>

    <script src="https://cdn.jsdelivr.net/npm/vega@5/build-es5/vega.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4/build-es5/vega-lite.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6/build-es5/vega-embed.js"></script>
    <!--D3-->
    <script src="https://d3js.org/d3.v5.min.js"></script>

</head>

<body>


    
    <!-- For keyboard users -->
    <a class="sr-only sr-only-focusable skip-menu" href="#skip-header-target">Skip Header</a>

    <header id="global-header" class="titleslide" role="banner" style="background-image: url(images/background.png);">

        <div class="bg-black text-white" id="nyc-top-header">

            <div class="container-fluid wide">

                <div class="row py-1 align-items-center justify-content-between">

                    <div class="col-auto">
                        <p class="d-none d-md-flex fs-md">
                            <a class="text-reset" href="https://www1.nyc.gov/">
                                <strong>nyc.gov</strong>
                            </a>
                            <span class="mx-1" aria-hidden="true">|</span>
                            Department of Health
                        </p>
                    </div>
                    <!-- .col -->

                    <div class="col-auto">

                        <ul class="extensible-list horizontal fs-md">
                            <li>
                                <a class="text-reset" href="http://www1.nyc.gov/">
                                    <strong>
                                        311
                                    </strong>
                                </a>
                            </li>
                            <li>
                                <a class="text-reset" href="http://www1.nyc.gov/home/search/index.page">
                                    <strong>
                                        Search all NYC.gov
                                    </strong>
                                </a>
                            </li>
                            <li>
                                <a href="https://www1.nyc.gov/" title="Go to nyc.gov">
                                    <img class="d-block" src="images/nyc-bubble-logo.svg" width="45" alt="NYC Logo">
                                </a>
                            </li>
                        </ul>

                    </div>
                    <!-- .col -->

                </div>
                <!-- .row -->

            </div>
            <!-- .container-fluid -->

        </div>
        <!-- #nyc-top-header -->

        <div class="wrap-header">

            <div class="container-fluid">

                <div class="row align-items-center">

                    <div class="col-lg py-2">
                        <div class="d-flex justify-content-lg-start">
                            <a class="align-self-center" href="#" title="Home">

                                <!-- Placeholder logo, replace the following <svg> tag with your own image version -->
                                    <a href="https://a816-dohbesp.nyc.gov/IndicatorPublic/">
                                        <i class="fas fa-home"></i>&nbsp;EH Data Portal Home 
                                    </a>

                            </a>
                        </div>
                    </div>


                    <!-- .col -->

                    <div class="col-lg-auto border-top border-lg-0">

                        <div class="d-lg-flex align-items-center">

                            <!-- Mobile Toggle Buttons -->

                            <ul class="extensible-list horizontal justify-content-between my-2 d-lg-none">
                                <li>
                                    <button class="no-btn-style" type="button" data-toggle="collapse"
                                        data-target="#global-language" aria-controls="global-language"
                                        aria-expanded="false">
                                        <span class="fas fa-language fa-lg" ></span>
                                    </button>
                                </li>


                            </ul>

                            <div class="collapse d-lg-block mx-n2 mx-lg-2" id="nav-primary">

                            </div>

                            <!-- Desktop Toggle Buttons -->

                            <ul class="extensible-list horizontal d-none d-lg-flex">
                                <li>
                                    <button class="no-btn-style" type="button" title="Language" data-toggle="collapse"
                                        data-target="#global-language" aria-controls="global-language"
                                        aria-expanded="false">
                                        <span class="sr-only">Language</span>
                                        <span class="fas fa-language fa-lg" ></span>
                                    </button>
                                </li>

                            </ul>

                        </div>
                        <!-- .d-flex -->

                    </div>
                    <!-- .col -->

                </div>
                <!-- .row -->

            </div>
            <!-- .container-fluid -->

        </div>
        <!-- .wrap-header -->

        <div class="container-fluid border-top collapse" id="global-language">
            <div class="narrow py-2">
                <div id="google_translate_element"></div>
            </div>
        </div>

        <div class="container-fluid border-top collapse" id="global-search">
            <form class="narrow py-2" aria-label="Search" role="search">
                <div class="input-group">
                    <label class="sr-only" for="global-search-bar">Search</label>
                    <input class="form-control form-control-lg" id="global-search-bar" placeholder="Search">
                    <div class="input-group-btn">
                        <button class="btn btn-primary btn-lg" type="button" title="Search">
                            <span class="sr-only">Search</span>
                            <span class="fas fa-arrow-right" ></span>
                        </button>
                    </div>
                </div>
            </form>
        </div>




    </header>
    <!-- #global-header -->



    <main id="skip-header-target" role="main" style="background-color:#f8f9fa;">
        <div class="container fs-sm">
                <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="https://a816-dohbesp.nyc.gov/IndicatorPublic/">EH Data Portal Home
                                </a></li>
                            <li class="breadcrumb-item"><a href="index.html">Air Quality Hub</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Real-Time Air Quality</li>
                        </ol>
    
                    </nav>

            <div class="row mt-3">
                <div class="col-lg-12">
                    <a href="explorer.html">
                        <button type="button" class="btn btn-secondary btn-sm float-right">Neighborhood air quality data</button></a>
                    <h2>Real-Time Air Quality</h2>
                   
                </div>

            </div>

            <div class="row mt-2">
                <div class="col-md-7">
                    <p>NYC's air quality is generally good <a href="http://a816-dohbesp.nyc.gov/IndicatorPublic/Closerlook/breatheeasy/index.html">and has been improving over time</a>. For PM2.5 (fine particles in the air), NYC meets the national air quality standard of an annual average of 12 μg/m<sup>3</sup>. </p>
                    
                    <p>But hour to hour, there's large variation in our air quality - even in neighborhoods with the cleanest air. That means sometimes, New Yorkers are exposed to high levels of <a href="">pollutants like PM2.5 that can harm health.</a> </p>
                    <p>These high levels are driven by daily changes in traffic volume, weather patterns that can trap emissions, and other short-term events.</p>
                    <div class="px-2 py-2 my-2" style="background-color:#f0f0f0; border-radius: 5px;">
                        <strong>About the Data</strong>
                        <p>Data are hourly measurements of PM2.5, measured in micrograms per cubic meter of air. Data come from the NYCCAS near-real-time monitor network. <a href="https://github.com/nychealth/realtime-air-quality">Visit our Github repository to download these data</a>. </p>
                   </div>
                </div>

                <div class="col-md-5 ml-auto">
                    <iframe title="Real time AQ monitors" aria-label="map" id="datawrapper-chart-O4tHk" src="https://datawrapper.dwcdn.net/O4tHk/4/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="350"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
                    </script>
                </div>
            </div>

            <hr>

            <div class="row mt-2 px-0">
                <div class="col">

                    <div class="row">
                        <div class="col">
                            <p><em>Highlight location:</em></p>
                        </div>
                    </div>

                    <div class="row py-1">
                        <div class="col-md-9">
                            <button onclick="changeData(0)" type="button" id="btn0" class="mb-1 selectorbtn btn btn-sm btn-outline-primary">Broadway/35th</button>
                            <button onclick="changeData(1)" type="button" id="btn1"  class="mb-1 selectorbtn btn btn-sm btn-outline-primary">Cross Bronx Expwy</button>
                            <button onclick="changeData(2)" type="button" id="btn2" class="mb-1 selectorbtn btn btn-sm btn-outline-primary">Queensboro Br</button>
                            <button onclick="changeData(3)" type="button" id="btn3" class="mb-1 selectorbtn btn btn-sm btn-outline-primary">Williamsburg Br</button>
                            <button onclick="changeData(4)" type="button" id="btn4" class="mb-1 selectorbtn btn btn-sm btn-outline-primary">Manhattan Br</button>
                            <button onclick="changeData(5)" type="button" id="btn5" class="mb-1 selectorbtn btn btn-sm btn-outline-primary">Queens College</button>

    
                        </div>

                        <div class="col-md-3">
                            <button onclick="restore()" type="button" id="btnrestore" class="mb-1 selectorbtn btn btn-sm btn-outline-primary float-right">Show all locations</button> 
                        </div>



                    </div>

                    <div class="row mt-2">
                        <div class="col pl-2">
                            <em class="pl-2">Hourly PM2.5 measurements, in µg/m3 (micrograms per cubic meter of air)</em>
                            <div id="vis2" style="width: 100%; height: 400px;">
                            
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-9 mr-auto">
                            <p><em class="pl-2">Last measurement: <span id="printTime"></span></em></p>
                            {{/*  <p class="pl-2">Most recent 24-hour average for <span id="loc">LOCATION</span>: <span id="24av">XX</span> µg/m3. This is <span class="comparison">ABOVE/BELOW</span> the 24-hour  National Ambient Air Quality Standard.</p>  */}}
                        </div>

                        <div class="col-md-3 ml-auto">
                            <form id="numberinput" class="float-right px-1 py-2" style="font-size: 12px; background-color: #eeeeee; border-radius: 3px; clear: all;">
                                <label for="inputNum" style="display:inline-block; font-size: 12px;">Show last</label>
                                <input type="number" style="display:inline-block" id="inputNum" name="inputNum" min="1" max="7">
                               days.   
                              </form> 
                        </div>
                    </div>

                    </div>
            </div>


            <hr>

            <div class="row mt-6">
                <div class="col-md-6">
                    <h3>Air quality varies because sources vary</h3>
                    <p>In New York City, about 45% of PM2.5 comes from far-away sources, like coal-burning power plants in the Midwest. But the rest comes from <b>local sources</b>. When we study air quality in every neighborhood of the city, we're able to identify the sources that are most closely associated with higher levels of air pollution.</p>

                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="fs-lg"><i class="fas fa-building mr-1" aria-hidden="true"></i>Buildings</h4>
                            <p>Building density affects a neighborhood's air quality because like vehicles, buildings burn fuel and emit pollutants: their boilers burn oil and gas to produce heat and hot water. This is one reason we often see more air pollution in the winter.</p>
                            <p>Because of new heating oil regulations, PM2.5 has gone down dramatically, and SO2 levels are now indetectable. <a href="https://nyc-ehs.net/besp-report/web/nyccas">Read more at the NYCCAS annual report</a>. </p>
        
                            <h4 class="fs-lg"><i class="fas fa-industry mr-1" aria-hidden="true"></i>Industrial area</h4>
                            <p> Industrial areas affect a neighborhood's air quality because of diesel exhaust from trucks idling and traveling through industrial areas, and from industrial combustion equipment.</p>
        
                            <h4 class="fs-lg"> <i class="fas fa-car mr-1" aria-hidden="true"></i>Traffic</h4>
                            <p> Traffic density affects a neighborhood's air quality because engines produce PM2.5, black carbon, and NOx. While electric vehicles help reduce emissions, all vehicles also contribute to PM2.5 through tire wear and braking. Traffic volume is one reason we often see daily spikes in PM2.5 concentration in the mornings and evenings.</p>
        
                            <h4 class="fs-lg"><i class="fas fa-truck mr-1" aria-hidden="true"></i>Trucks</h4>
                            <p>Truck traffic density affects a neighborhood's air quality because diesel combustion produces additional pollutants.</p>
                        </div>
                    </div>



                </div>

                <div class="col-md-6">
                    <h3>Common patterns in the data</h3>
                    <p>Commonly, we can see spatial differences in air quality (different air quality in different locations), as well as weather patterns, daily spikes, and other spikes that show up in the data. Take a look at the images and see if you can see similar patterns in today's data - or come back tomorrow to check.</p>



                    <div class="card mb-4">
                        <div class="card-body">

                        <div class="row px-2">
                            <div class="nav flex-fill nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                <a class="nav-link active" id="v-pills-spatial-tab" data-toggle="pill" href="#v-pills-spatial" role="tab" aria-controls="v-pills-spatial" aria-selected="true">Spatial differences</a>
                                <a class="nav-link" id="v-pills-daily-tab" data-toggle="pill" href="#v-pills-daily" role="tab" aria-controls="v-pills-daily" aria-selected="false">Daily spikes</a>

                                <a class="nav-link" id="v-pills-weather-tab" data-toggle="pill" href="#v-pills-weather" role="tab" aria-controls="v-pills-weather" aria-selected="false">Weather patterns</a>
                                <a class="nav-link" id="v-pills-other-tab" data-toggle="pill" href="#v-pills-other" role="tab" aria-controls="v-pills-other" aria-selected="false">Other spikes</a>
                              </div>
                        </div>

                        <div class="row p-2">
                            <div class="tab-content" id="v-pills-tabContent">
                                <div class="tab-pane fade show active" id="v-pills-spatial" role="tabpanel" aria-labelledby="v-pills-spatial-tab">
                                        
                                                <figure class="figure">
                                                            The monitors are in neighborhoods with different emissions sources, so have different PM2.5 levels. <span style="color:gray"><b>Midtown</b></span> has the highest traffic density, usually has the most PM2.5. </figcaption>
                                                    <img src="images/a-spatial.png" class="figure-img img-fluid rounded" alt="ALT TEXT HERE">
                                                    
                                                </figure>
                                </div>
                                <div class="tab-pane fade" id="v-pills-daily" role="tabpanel" aria-labelledby="v-pills-daily-tab">
                                        
                                                <figure class="figure">
PM2.5 levels usually rise in the morning as traffic volume increases. These <em>temporal</em> differences (time spikes) are usually greater than <em>spatial</em> differences (the differences between neighborhoods).</figcaption>
                                                    <img src="images/a-daily.png" class="figure-img img-fluid rounded" alt="Daily changes in PM2.5 measurements from air quality monitors">
                                                    
                                                </figure>
                                </div>
                                <div class="tab-pane fade" id="v-pills-other" role="tabpanel" aria-labelledby="v-pills-other-tab">
                                       
                                                <figure class="figure">
                                                        Sometimes there are <span style="color:gray;"><b>dramatic spikes</b></span> at unexpected times, and without having a camera on each monitor, we don't know what causes them - however, they can be explained by something as simple as a truck idling for a few minutes underneath the monitor.</figcaption>
                                                        <img src="images/a-spike.png" class="figure-img img-fluid rounded" alt="A spike in PM2.5 measurements from one air quality monitor">
                                                    
                                                </figure>
                                </div>
                                <div class="tab-pane fade" id="v-pills-weather" role="tabpanel" aria-labelledby="v-pills-weather-tab">
                                        
                                                <figure class="figure">
                                                        Weather can trap emissions and cause PM2.5 to build up. Sometimes we see a clear west-to-east pattern in rising PM2.5, likely related to a weather pattern moving in to New York City and causing pollution levels to rise as emissions are trapped.</figcaption>
                                                    <img src="images/a-weather.png" class="figure-img img-fluid rounded" alt="ALT TEXT HERE">
                                                    
                                                </figure>
                                </div>
                              </div>
                        </div>

                
                            </div>
                        </div>

                </div>
            </div>
        </div>  
    </main>

    <footer class="bg-black" id="global-footer" role="contentinfo">

        <h2 class="sr-only">
            Page Footer
        </h2>

        <div class="bg-opacity-black-25 text-white" id="nyc-footer">

            <div class="container py-3 d-none" id="languages">

                <div class="row fs-md">

                    <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                        <ul class="extensible-list">
                            <li><a class="lang-select text-reset" href="#" data-lang="ar">عربى</a></li>
                            <li><a class="lang-select text-reset" href="#" data-lang="bn">বাঙালি</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                        <ul class="extensible-list">
                            <li><a class="lang-select text-reset" href="#" data-lang="zh-CN">中文</a></li>
                            <li><a class="lang-select text-reset" href="#" data-lang="fr">français</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                        <ul class="extensible-list">
                            <li><a class="lang-select text-reset" href="#" data-lang="ht">Kreyòl Ayisyen</a></li>
                            <li><a class="lang-select text-reset" href="#" data-lang="ko">한국어</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                        <ul class="extensible-list">
                            <li><a class="lang-select text-reset" href="#" data-lang="pl">Polskie</a></li>
                            <li><a class="lang-select text-reset" href="#" data-lang="ru">русский</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-md-4 col-lg">
                        <ul class="extensible-list">
                            <li><a class="lang-select text-reset" href="#" data-lang="es">Español</a></li>
                            <li><a class="lang-select text-reset" href="#" data-lang="ur">اردو</a></li>
                        </ul>
                    </div>
                </div>

            </div>
            <!-- #languages -->

            <div class="container py-3" id="languages">

                <ul class="fs-md" role="list">
                    <li><a class="lang-select text-reset" href="#" data-lang="ar">عربى</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="bn">বাঙালি</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="zh-CN">中文</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="fr">français</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="ht">Kreyòl Ayisyen</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="ko">한국어</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="pl">Polskie</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="ru">русский</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="es">Español</a></li>
                    <li><a class="lang-select text-reset" href="#" data-lang="ur">اردو</a></li>
                </ul>

            </div>
            <!-- #languages -->

            <hr class="opacity-10" aria-hidden="true">

            <div class="container py-3">

                <div class="row">

                    <div class="col-md-6 col-lg-8 mb-3 mb-lg-0">

                        <nav class="row fs-md" role="navigation">

                            <div class="col-lg mb-3 mb-lg-0">

                                <ul class="extensible-list">
                                    <li>
                                        <a class="text-reset" href="http://www1.nyc.gov/nyc-resources/agencies.page">
                                            <strong>City Agencies</strong>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="text-reset" href="https://a858-nycnotify.nyc.gov/notifynyc/">
                                            <strong>Notify NYC</strong>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="text-reset"
                                            href="http://www1.nyc.gov/connect/mobile-applications.page">
                                            <strong>NYC Mobile Apps</strong>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <!-- .col -->

                            <div class="col-lg mb-3 mb-lg-0">

                                <ul class="extensible-list">
                                    <li>
                                        <a class="text-reset" href="http://www1.nyc.gov/home/contact-us.page">
                                            <strong>Contact NYC Government</strong>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="text-reset" href="https://a856-citystore.nyc.gov/">
                                            <strong>CityStore</strong>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="text-reset" href="http://maps.nyc.gov/doitt/nycitymap/">
                                            <strong>Maps</strong>
                                        </a>
                                    </li>
                                </ul>

                            </div>
                            <!-- .col -->

                            <div class="col-lg mb-3 mb-lg-0">

                                <ul class="extensible-list">
                                    <li>
                                        <a class="text-reset"
                                            href="https://a127-ess.nyc.gov/psp/prdess/?cmd=login&languageCd=ENG&">
                                            <strong>City Employees</strong>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="text-reset" href="http://www1.nyc.gov/connect/social-media.page">
                                            <strong>Stay Connected</strong>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="text-reset"
                                            href="http://www1.nyc.gov/nyc-resources/resident-toolkit.page">
                                            <strong>Resident Toolkit</strong>
                                        </a>
                                    </li>
                                </ul>

                            </div>
                            <!-- .col -->

                        </nav>

                    </div>
                    <!-- .col -->

                    <div class="col-md-6 col-lg-4">

                        <a class="mb-2" href="https://www1.nyc.gov" title="Go to nyc.gov" target="_blank">
                            <img class="mb-2" src="./images/nyc-bubble-logo.svg" width="90" alt="NYC Logo">
                        </a>
                        <p class="fs-sm">City of New York - 2019 All Rights Reserved. NYC is a trademark and service
                            mark of the City of New York.</p>

                        <ul class="extensible-list horizontal fs-sm">
                            <li>
                                <a class="text-reset" href="http://www1.nyc.gov/home/privacy-policy.page">Privacy
                                    Policy</a>
                            </li>
                            <li>
                                <a class="text-reset" href="http://www1.nyc.gov/home/terms-of-use.page">Terms
                                    of Use</a>
                            </li>
                            <li>
                                <a class="text-reset" href="http://www1.nyc.gov/site/mopd/index.page"
                                    title="Mayor's Office for People with Disabilities">
                                    <span class="sr-only">Mayor's Office for People with Disabilities</span>
                                    <span class="fab fa-lg fa-accessible-icon"></span>
                                </a>
                            </li>
                        </ul>

                    </div>
                    <!-- .col -->

                </div>
                <!-- .row -->

            </div>
            <!-- .container -->

        </div>
        <!-- #nyc-bottom-footer -->

    </footer>

    <!-- jQuery (full, compressed version) -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <!-- Popper.js and Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- Google Translate -->
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en'
            }, 'google_translate_element');
        }
    </script>

    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<!--Arquero-->
<script src="https://cdn.jsdelivr.net/npm/arquero@latest"></script>

<!--Chart spec-->
<script>

var dt;
var fullTable;
var shortTable;
var locSelect = "No location"

// Loads the csv as an arquero table
aq.loadCSV(
"https://raw.githubusercontent.com/nychealth/realtime-air-quality/main/RT_flat.csv"
).then(data => {
dt = data;

fullTable = dt.objects(); // puts the data into fullTable to use. 
shortTable = fullTable; // creating an array we'll slice for time-selection

// inserts fullTable into the spec and draws the chart
vegaEmbed("#vis2", spec).then((res) =>
res.view.insert("lineData", fullTable).run()
);

});

var inputNum; // the number of days we want to select

// event listener on the time-selection form
document.getElementById('inputNum').addEventListener('change',function() {
    event.preventDefault();
    inputNum = document.getElementById('inputNum').value;
    updateChart(inputNum);
});



// this function updates the chart based on timeselection
function updateChart(x) {
    var inputHours // hours in a day
    inputHours = x * 24;
    var startingPoint; 
    startingPoint = fullTable.length - inputHours;
    console.log('show chart for ' + inputHours + " hours");

    shortTable = fullTable.slice(startingPoint, fullTable.length)
    console.log(shortTable);

    vegaEmbed("#vis2", spec).then((res) =>
    res.view.insert("lineData", shortTable).run()
  );

}


// establish the original spec. 
const origSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "description":"Real-time air quality",
    "width":"container",
    "height":"container",
    "config":{
       "background":"#ffffff00",
       "axisX":{
          "grid":false,
          "ticks":true,
          "labels":true
       },
       "axisY":{
          "domain":false,
          "ticks":false,
          "gridDash":[
             2
          ],
          "gridWidth":1
       },
       "view":{
          "stroke":"transparent"
       }
    },
    "data":{
       "name":"lineData"
    },
    "layer":[
       {
          "mark":{
             "type":"line",
             "point":false,
             "tooltip":true,
             "interpolate":"natural",
             "strokeWidth":1.5
          },
          "encoding":{
             "x":{
                "field":"starttime",
                "type":"temporal",
                "title":" "
             },
             "y":{
                "field":"Broadway/35th St",
                "type":"quantitative",
                "title":" "
             },
             "color":{
                "value":"darkgray"
             },
             "tooltip":[
                {
                   "field":"Broadway/35th St",
                   "title":"PM2.5 (µg/m3)"
                },
                {
                  "field":"TOD",
                  "type": "nominal",
                  "title":"Time"
               },
                {
                   "field":"starttime",
                   "type":"temporal",
                   "title":"Date"
                }
             ]
          }
       },
       {
          "mark":{
             "type":"line",
             "point":false,
             "tooltip":true,
             "interpolate":"natural",
             "strokeWidth":1.5
          },
          "encoding":{
             "x":{
                "field":"starttime",
                "type":"temporal",
                "title":" "
             },
             "y":{
                "field":"Cross Bronx Expy",
                "type":"quantitative",
                "title":" "
             },
             "color":{
                "value":"purple"
             },
             "tooltip":[
                {
                   "field":"Cross Bronx Expy",
                   "title":"PM2.5 (µg/m3)"
                },
                {
                  "field":"TOD",
                  "type": "nominal",
                  "title":"Time"
               },
                {
                   "field":"starttime",
                   "type":"temporal",
                   "title":"Date"
                }
             ]
          }
       },
       {
          "mark":{
             "type":"line",
             "point":false,
             "tooltip":true,
             "interpolate":"natural",
             "strokeWidth":1.5
          },
          "encoding":{
             "x":{
                "field":"starttime",
                "type":"temporal",
                "title":" "
             },
             "y":{
                "field":"Queensboro Bridge",
                "type":"quantitative",
                "title":" "
             },
             "color":{
                "value":"pink"
             },
             "tooltip":[
                {
                   "field":"Queensboro Bridge",
                   "title":"PM2.5 (µg/m3)"
                },
              {
                "field":"TOD",
                "type": "nominal",
                "title":"Time"
             },
                {
                   "field":"starttime",
                   "type":"temporal",
                   "title":"Date"
                }
             ]
          }
       },
       {
          "mark":{
             "type":"line",
             "point":false,
             "tooltip":true,
             "interpolate":"natural",
             "strokeWidth":1.5
          },
          "encoding":{
             "x":{
                "field":"starttime",
                "type":"temporal",
                "title":" "
             },
             "y":{
                "field":"Williamsburg Bridge",
                "type":"quantitative",
                "title":" "
             },
             "color":{
                "value":"blue"
             },
             "tooltip":[
                {
                   "field":"Williamsburg Bridge",
                   "title":"PM2.5 (µg/m3)"
                },
                ,
              {
                "field":"TOD",
                "type": "nominal",
                "title":"Time"
             },
                {
                   "field":"starttime",
                   "type":"temporal",
                   "title":"Date"
                }
             ]
          }
       },
       {
          "mark":{
             "type":"line",
             "point":false,
             "tooltip":true,
             "interpolate":"natural",
             "strokeWidth":1.5
          },
          "encoding":{
             "x":{
                "field":"starttime",
                "type":"temporal",
                "title":" "
             },
             "y":{
                "field":"Manhattan Bridge",
                "type":"quantitative",
                "title":" "
             },
             "color":{
                "value":"green"
             },
             "tooltip":[
                {
                   "field":"Manhattan Bridge",
                   "title":"PM2.5 (µg/m3) Bridge"
                },
                {
                  "field":"TOD",
                  "type": "nominal",
                  "title":"Time"
               },
                {
                   "field":"starttime",
                   "type":"temporal",
                   "title":"Date"
                }
             ]
          }
       },
       {
        "mark":{
           "type":"line",
           "point":false,
           "tooltip":true,
           "interpolate":"natural",
           "strokeWidth":1.5
        },
        "encoding":{
           "x":{
              "field":"starttime",
              "type":"temporal",
              "title":" "
           },
           "y":{
              "field":"Queens College",
              "type":"quantitative",
              "title":" "
           },
           "color":{
              "value":"orange"
           },
           "tooltip":[
              {
                 "field":"Queens College",
                 "title":"PM2.5 (µg/m3)"
              },
              {
                "field":"TOD",
                "type": "nominal",
                "title":"Time"
             },
              {
                 "field":"starttime",
                 "type":"temporal",
                 "title":"Date"
              }
           ]
        }
     }
    ]
 };

// establish the spec that we'll manipulate and chart.
var spec = origSpec;

// Grab the buttons for manipulation later
var buttons = document.querySelectorAll('.selectorbtn');

// this function updates the chart based on the location selection
function changeData(x) {
    // remove active class from buttons and add default class
    buttons.forEach(button => button.classList.remove('btn-primary'))
    buttons.forEach(button => button.classList.add('btn-outline-primary'))


    // add active class for selected button and remove default class
    var btn = "btn"+x;
    document.getElementById(btn).classList.add('btn-primary');
    document.getElementById(btn).classList.remove('btn-outline-primary')


    // make all lines gray, thinner, and unmarked
    for (let i = 0; i < 6; i++) {
        spec.layer[i].encoding.color.value = "lightgray"
        spec.layer[i].mark.strokeWidth = 1
        spec.layer[i].mark.point = false
        };

    // create a color variable
    var color;
    if (x==0) {
        color = "darkgray";
        locSelect = "Broadway/35th St"
    } else if (x==1) {
        color = "purple";
        locSelect = "Cross Bronx Expy"
    } else if (x==2) {
        color = "pink";
        locSelect = "Queensboro Bridge"
    } else if (x==3) {
        color = "blue";
        locSelect = "Williamsburg Bridge";
    } else if (x==4) {
        color = "green";
        locSelect = "Manhattan Bridge";
    } else if (x==5) {
        color = "orange";
        locSelect = "Queens College";
    } else {};

    console.log(locSelect)

    // style the selected series
    spec.layer[x].encoding.color.value = color
    spec.layer[x].mark.strokeWidth = 2.5
    spec.layer[x].mark.point = true

    // redraw the chart
    vegaEmbed("#vis2", spec).then((res) =>
    res.view.insert("lineData", shortTable).run()
    );

    // run getAverage
    getAverage(x);

    }

var avTable; // creating an abridged data table
var selectedLoc;

var arqTable;


// Here, we'll calculate the most recent 24-hour average for a selected neighborhood.
function getAverage() {
    var startAt = fullTable.length - 24; // get a starting point of most recent 24 hours
    avTable = fullTable.slice(startAt, fullTable.length) // slicing the table to most recent 24 hours
    console.log(avTable)

    document.getElementById('printTime').innerHTML = avTable[23].starttime

    arqTable = aq.from(avTable);

    // Filter by selected neighborhood
    // Count number of entries. Stop if there are <18 entries.
    // Else, average the entries
    // Print this value to 24av
    // If this is above 35, print HIGHER; else, print LOWER to comparison

    // Note - this may be easier with long version; location-selection buttons can apply a filter to the long file, which we can then pipe into the chart. 

}

//runs getAverage on slight delay so fullTable loads
// setTimeout( function() { getAverage(); }, 3000);


// reload page to restore defaults. There may be a better way to do this!
function restore() {
    location.reload();
}


</script>


</body>

</html>